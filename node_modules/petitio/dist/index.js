var kt=Object.create,X=Object.defineProperty,St=Object.defineProperties,Rt=Object.getOwnPropertyDescriptor,Ct=Object.getOwnPropertyDescriptors,vt=Object.getOwnPropertyNames,Ne=Object.getOwnPropertySymbols,Ot=Object.getPrototypeOf,Pe=Object.prototype.hasOwnProperty,Lt=Object.prototype.propertyIsEnumerable;var Ae=(t,e,r)=>e in t?X(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,He=(t,e)=>{for(var r in e||(e={}))Pe.call(e,r)&&Ae(t,r,e[r]);if(Ne)for(var r of Ne(e))Lt.call(e,r)&&Ae(t,r,e[r]);return t},De=(t,e)=>St(t,Ct(e)),xt=t=>X(t,"__esModule",{value:!0});var $=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var _t=(t,e,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of vt(e))!Pe.call(t,n)&&n!=="default"&&X(t,n,{get:()=>e[n],enumerable:!(r=Rt(e,n))||r.enumerable});return t},Y=t=>_t(xt(X(t!=null?kt(Ot(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var qe=$((or,Ee)=>{"use strict";var Ue=require("_http_common");Ue.HTTPParser?Ee.exports=Ue.HTTPParser:Ee.exports=process.binding("http_parser").HTTPParser});var ke=$((ur,Ie)=>{Ie.exports={kUrl:Symbol("url"),kWriting:Symbol("writing"),kResuming:Symbol("resuming"),kQueue:Symbol("queue"),kConnect:Symbol("connect"),kIdleTimeout:Symbol("idle timeout"),kIdleTimeoutValue:Symbol("idle timeout value"),kKeepAliveDefaultTimeout:Symbol("default keep alive timeout"),kKeepAliveMaxTimeout:Symbol("max keep alive timeout"),kKeepAliveTimeoutThreshold:Symbol("keep alive timeout threshold"),kKeepAliveTimeoutValue:Symbol("keep alive timeout"),kKeepAlive:Symbol("keep alive"),kHeadersTimeout:Symbol("headers timeout"),kBodyTimeout:Symbol("body timeout"),kTLSServerName:Symbol("server name"),kHost:Symbol("host"),kTLSOpts:Symbol("TLS Options"),kClosed:Symbol("closed"),kNeedDrain:Symbol("need drain"),kReset:Symbol("reset"),kDestroyed:Symbol("destroyed"),kMaxHeadersSize:Symbol("max headers size"),kRunningIdx:Symbol("running index"),kPendingIdx:Symbol("pending index"),kError:Symbol("error"),kClient:Symbol("client"),kParser:Symbol("parser"),kOnDestroyed:Symbol("destroy callbacks"),kPipelining:Symbol("pipelinig"),kSocketPath:Symbol("socket path"),kSocket:Symbol("socket"),kTLSSession:Symbol("tls session cache"),kHostHeader:Symbol("host header"),kAgentOpts:Symbol("agent opts"),kAgentCache:Symbol("agent cache")}});var ce=$((ar,Be)=>{"use strict";var S=class extends Error{constructor(e){super(e);this.name="UndiciError",this.code="UND_ERR"}},Z=class extends S{constructor(e){super(e);Error.captureStackTrace(this,Z),this.name="HeadersTimeoutError",this.message=e||"Headers Timeout Error",this.code="UND_ERR_HEADERS_TIMEOUT"}},ee=class extends S{constructor(e){super(e);Error.captureStackTrace(this,ee),this.name="BodyTimeoutError",this.message=e||"Body Timeout Error",this.code="UND_ERR_BODY_TIMEOUT"}},te=class extends S{constructor(e){super(e);Error.captureStackTrace(this,te),this.name="InvalidArgumentError",this.message=e||"Invalid Argument Error",this.code="UND_ERR_INVALID_ARG"}},re=class extends S{constructor(e){super(e);Error.captureStackTrace(this,re),this.name="InvalidReturnValueError",this.message=e||"Invalid Return Value Error",this.code="UND_ERR_INVALID_RETURN_VALUE"}},ne=class extends S{constructor(e){super(e);Error.captureStackTrace(this,ne),this.name="RequestAbortedError",this.message=e||"Request aborted",this.code="UND_ERR_ABORTED"}},se=class extends S{constructor(e){super(e);Error.captureStackTrace(this,se),this.name="InformationalError",this.message=e||"Request information",this.code="UND_ERR_INFO"}},ie=class extends S{constructor(e){super(e);Error.captureStackTrace(this,ie),this.name="ContentLengthMismatchError",this.message=e||"Request body length does not match content-length header",this.code="UND_ERR_CONTENT_LENGTH_MISMATCH"}},oe=class extends S{constructor(e){super(e);Error.captureStackTrace(this,oe),this.name="TrailerMismatchError",this.message=e||"Trailers does not match trailer header",this.code="UND_ERR_TRAILER_MISMATCH"}},ue=class extends S{constructor(e){super(e);Error.captureStackTrace(this,ue),this.name="ClientDestroyedError",this.message=e||"The client is destroyed",this.code="UND_ERR_DESTROYED"}},ae=class extends S{constructor(e){super(e);Error.captureStackTrace(this,ae),this.name="ClientClosedError",this.message=e||"The client is closed",this.code="UND_ERR_CLOSED"}},he=class extends S{constructor(e){super(e);Error.captureStackTrace(this,he),this.name="SocketError",this.message=e||"Socket error",this.code="UND_ERR_SOCKET"}},le=class extends S{constructor(e){super(e);Error.captureStackTrace(this,le),this.name="NotSupportedError",this.message=e||"Not supported error",this.code="UND_ERR_NOT_SUPPORTED"}};Be.exports={UndiciError:S,HeadersTimeoutError:Z,BodyTimeoutError:ee,ContentLengthMismatchError:ie,TrailerMismatchError:oe,InvalidArgumentError:te,InvalidReturnValueError:re,RequestAbortedError:ne,ClientDestroyedError:ue,ClientClosedError:ae,InformationalError:se,SocketError:he,NotSupportedError:le}});var Se=$((hr,$e)=>{"use strict";var Me=require("assert"),{kDestroyed:je}=ke(),{IncomingMessage:Nt}=require("http"),Pt=require("util"),At=require("net"),{InvalidArgumentError:F}=ce();function Ht(){}function ze(t){return!!(t&&typeof t.on=="function")}function Ke(t){if(typeof t=="string"&&(t=new URL(t)),!t||typeof t!="object")throw new F("invalid url");if(t.port!=null&&t.port!==""&&!Number.isFinite(parseInt(t.port)))throw new F("invalid port");if(t.hostname!=null&&typeof t.hostname!="string")throw new F("invalid hostname");if(!/https?/.test(t.protocol))throw new F("invalid protocol");if(!(t instanceof URL)){let e=t.port||{"http:":80,"https:":443}[t.protocol];Me(e!=null);let r=t.path||`${t.pathname||"/"}${t.search||""}`;t=new URL(`${t.protocol}//${t.hostname}:${e}${r}`)}return t}function Dt(t){if(t=Ke(t),/\/.+/.test(t.pathname)||t.search||t.hash)throw new F("invalid url");return t}function Ut(t){if(!t)return null;let e=t;if(e.startsWith("[")){let r=e.indexOf("]");e=r===-1?e:e.substr(1,r-1)}else e=e.split(":",1)[0];return At.isIP(e)&&(e=null),e}function qt(t){if(t&&typeof t.on=="function"){let e=t._readableState;return e&&e.ended===!0&&Number.isFinite(e.length)?e.length:null}return Me(!t||Number.isFinite(t.byteLength)),t?t.length:0}function Fe(t){return!t||!!(t.destroyed||t[je])}function It(t,e){!ze(t)||Fe(t)||(typeof t.destroy=="function"?(e||Object.getPrototypeOf(t).constructor!==Nt)&&t.destroy(e):e&&process.nextTick((r,n)=>{r.emit("error",n)},t,e),t.destroyed!==!0&&(t[je]=!0))}var Bt=/timeout=(\d+)/;function $t(t){let e=t.match(Bt);return e?parseInt(e[1])*1e3:null}function Mt(t,e={}){for(let r=0;r<t.length;r+=2){let n=t[r].toLowerCase(),s=e[n];s?(Array.isArray(s)||(s=[s],e[n]=s),s.push(t[r+1])):e[n]=t[r+1]}return e}function jt(t){return t instanceof Uint8Array||Buffer.isBuffer(t)}function zt(t,e){let r=Pt.getSystemErrorName(t),n=new Error(`${e} ${r}`);return n.errno=n,n.code=t,n.syscall=e,n}$e.exports={nop:Ht,parseOrigin:Dt,parseURL:Ke,getServerName:Ut,errnoException:zt,isStream:ze,isDestroyed:Fe,parseHeaders:Mt,parseKeepAliveTimeout:$t,destroy:It,bodyLength:qt,isBuffer:jt,queueMicrotask:global.queueMicrotask?global.queueMicrotask.bind(global):t=>Promise.resolve().then(t).catch(e=>setTimeout(()=>{throw e},0))}});var We=$((lr,Ve)=>{"use strict";var{InvalidArgumentError:g,NotSupportedError:Kt}=ce(),Re=Se(),P=require("assert"),H=Symbol("handler"),Ft=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\x00a1-\xffff0-9]+-?)*[a-z\x00a1-\xffff0-9]+)(?:\.(?:[a-z\x00a1-\xffff0-9]+-?)*[a-z\x00a1-\xffff0-9]+)*(?:\.(?:[a-z\x00a1-\xffff]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/ius,Ge=class{constructor({path:e,method:r,body:n,headers:s,idempotent:o,upgrade:u},c){if(typeof e!="string")throw new g("path must be a string");if(e[0]!=="/"&&!Ft.test(e))throw new g("path must be an absolute URL or start with a slash");if(typeof r!="string")throw new g("method must be a string");if(u&&typeof u!="string")throw new g("upgrade must be a string");if(this.method=r,n==null)this.body=null;else if(Re.isStream(n))this.body=n;else if(Re.isBuffer(n))this.body=n.length?n:null;else if(typeof n=="string")this.body=n.length?Buffer.from(n):null;else throw new g("body must be a string, a Buffer or a Readable stream");if(this.aborted=!1,this.upgrade=u||r==="CONNECT"||null,this.path=e,this.idempotent=o==null?r==="HEAD"||r==="GET":o,this.host=null,this.contentLength=null,this.headers="",Array.isArray(s)){if(s.length%2!=0)throw new g("headers array must be even");for(let l=0;l<s.length;l+=2)Qe(this,s[l+0],s[l+1])}else if(s&&typeof s=="object")for(let[l,a]of Object.entries(s))Qe(this,l,a);else if(s!=null)throw new g("headers must be an object or an array");if(typeof c.onConnect!="function")throw new g("invalid onConnect method");if(typeof c.onError!="function")throw new g("invalid onError method");if(this.upgrade){if(typeof c.onUpgrade!="function")throw new g("invalid onUpgrade method")}else{if(typeof c.onHeaders!="function")throw new g("invalid onHeaders method");if(typeof c.onData!="function")throw new g("invalid onData method");if(typeof c.onComplete!="function")throw new g("invalid onComplete method")}this[H]=c}onConnect(e){return P(!this.aborted),this[H].onConnect(e)}onHeaders(e,r,n){return P(!this.aborted),this[H].onHeaders(e,r,n)}onData(e){return P(!this.aborted),P(!this.upgrade),this[H].onData(e)}onUpgrade(e,r,n){return P(!this.aborted),P(this.upgrade),this[H].onUpgrade(e,r,n)}onComplete(e){return P(!this.aborted),P(!this.upgrade),this[H].onComplete(e)}onError(e){this.aborted||(this.aborted=!0,Re.queueMicrotask(()=>this[H].onError(e)))}};function Qe(t,e,r){if(r&&typeof r=="object")throw new g(`invalid ${e} header`);if(r===void 0)return;if(t.host===null&&e.length===4&&e.toLowerCase()==="host")t.host=r,t.headers+=`${e}: ${r}\r
`;else if(t.contentLength===null&&e.length===14&&e.toLowerCase()==="content-length"){if(t.contentLength=parseInt(r),!Number.isFinite(t.contentLength))throw new g("invalid content-length header")}else{if(e.length===17&&e.toLowerCase()==="transfer-encoding")throw new g("invalid transfer-encoding header");if(e.length===10&&e.toLowerCase()==="connection")throw new g("invalid connection header");if(e.length===10&&e.toLowerCase()==="keep-alive")throw new g("invalid keep-alive header");if(e.length===7&&e.toLowerCase()==="upgrade")throw new g("invalid upgrade header");if(e.length===6&&e.toLowerCase()==="expect")throw new Kt("expect header not supported");t.headers+=`${e}: ${r}\r
`}}Ve.exports=Ge});var yt=$((cr,Je)=>{"use strict";var Xe=require("net"),Ye=require("tls"),w=qe(),Vt=require("events"),f=require("assert"),h=Se(),Gt=We(),{ContentLengthMismatchError:Ce,TrailerMismatchError:Ze,InvalidArgumentError:E,RequestAbortedError:et,HeadersTimeoutError:Qt,ClientDestroyedError:ve,ClientClosedError:Wt,SocketError:de,InformationalError:M,BodyTimeoutError:Jt}=ce(),{kUrl:N,kReset:L,kHost:fe,kClient:j,kParser:pe,kConnect:Xt,kResuming:D,kWriting:U,kQueue:y,kNeedDrain:V,kTLSServerName:me,kKeepAliveDefaultTimeout:Oe,kHostHeader:tt,kTLSOpts:ge,kClosed:z,kDestroyed:A,kPendingIdx:R,kRunningIdx:b,kError:ye,kOnDestroyed:q,kPipelining:I,kSocket:m,kSocketPath:G,kKeepAliveTimeoutValue:be,kMaxHeadersSize:we,kKeepAliveMaxTimeout:rt,kKeepAliveTimeoutThreshold:nt,kTLSSession:Q,kIdleTimeout:W,kIdleTimeoutValue:Te,kHeadersTimeout:J,kBodyTimeout:Le}=ke(),st=process.version.split("."),K=parseInt(st[0].slice(1)),it=parseInt(st[1]),Yt=process.execArgv.includes("--insecure-http-parser");function ot(t,e){return h.getServerName(e)||t[ge]&&t[ge].servername||h.getServerName(t[N].host||t[N].hostname)||null}var ut=class extends Vt{constructor(e,{maxHeaderSize:r,headersTimeout:n,socketTimeout:s,requestTimeout:o,bodyTimeout:u,idleTimeout:c,keepAlive:l,keepAliveTimeout:a,maxKeepAliveTimeout:i,keepAliveMaxTimeout:d,keepAliveTimeoutThreshold:p,socketPath:k,pipelining:O,tls:_}={}){super();if(l!==void 0)throw new E("unsupported keepAlive, use pipelining=0 instead");if(s!==void 0)throw new E("unsupported socketTimeout, use headersTimeout & bodyTimeout instead");if(o!==void 0)throw new E("unsupported requestTimeout, use headersTimeout & bodyTimeout instead");if(c!==void 0)throw new E("unsupported idleTimeout, use keepAliveTimeout instead");if(i!==void 0)throw new E("unsupported maxKeepAliveTimeout, use keepAliveMaxTimeout instead");if(r!=null&&!Number.isFinite(r))throw new E("invalid maxHeaderSize");if(k!=null&&typeof k!="string")throw new E("invalid socketPath");if(a!=null&&(!Number.isFinite(a)||a<=0))throw new E("invalid keepAliveTimeout");if(d!=null&&(!Number.isFinite(d)||d<=0))throw new E("invalid keepAliveMaxTimeout");if(p!=null&&!Number.isFinite(p))throw new E("invalid keepAliveTimeoutThreshold");if(n!=null&&(!Number.isInteger(n)||n<0))throw new E("headersTimeout must be a positive integer or zero");if(u!=null&&(!Number.isInteger(u)||u<0))throw new E("bodyTimeout must be a positive integer or zero");this[m]=null,this[I]=O!=null?O:1,this[we]=r||16384,this[N]=h.parseOrigin(e),this[G]=k,this[Oe]=a==null?4e3:a,this[rt]=d==null?6e5:d,this[nt]=p==null?1e3:p,this[be]=this[Oe],this[z]=!1,this[A]=!1,this[ge]=_,this[me]=ot(this),this[fe]=null,this[q]=[],this[D]=0,this[V]=0,this[Q]=null,this[tt]=`host: ${this[N].hostname}${this[N].port?`:${this[N].port}`:""}\r
`,this[Le]=u!=null?u:3e4,this[J]=n!=null?n:3e4,this[y]=[],this[b]=0,this[R]=0}get url(){return this[N]}get pipelining(){return this[I]}set pipelining(e){this[I]=e,x(this,!0)}get connected(){return this[m]&&this[m].connecting!==!0&&(this[m].authorized!==!1||this[m].authorizationError)&&!this[m].destroyed}get pending(){return this[y].length-this[R]}get running(){return this[R]-this[b]}get size(){return this[y].length-this[b]}get busy(){let e=this[m];return e&&(e[L]||e[U])||this.size>=(this[I]||1)||this.pending>0}get destroyed(){return this[A]}get closed(){return this[z]}[Xt](e){at(this),this.once("connect",e)}dispatch(e,r){try{let n=new Gt(e,r);if(this[A])throw new ve;if(this[z])throw new Wt;this[y].push(n),this[D]||(h.isStream(n.body)?(this[D]=1,process.nextTick(x,this)):x(this,!0))}catch(n){if(typeof r.onError!="function")throw new E("invalid onError method");r.onError(n)}}close(e){if(e===void 0)return new Promise((r,n)=>{this.close((s,o)=>s?n(s):r(o))});if(typeof e!="function")throw new E("invalid callback");if(this[A]){process.nextTick(e,new ve,null);return}this[z]=!0,this.size?this[q].push(e):this.destroy(e)}destroy(e,r){if(typeof e=="function"&&(r=e,e=null),r===void 0)return new Promise((s,o)=>{this.destroy(e,(u,c)=>u?o(u):s(c))});if(typeof r!="function")throw new E("invalid callback");if(this[A]){this[q]?this[q].push(r):process.nextTick(r,null,null);return}e||(e=new ve);for(let s of this[y].splice(this[R]))s.onError(e);this[z]=!0,this[A]=!0,this[q].push(r);let n=()=>{let s=this[q];this[q]=null;for(let o of s)o(null,null)};this[m]?h.destroy(this[m].on("close",n),e):process.nextTick(n),x(this)}},ht=class extends w{constructor(e,r){if(K===12&&it<19){super();this.initialize(w.RESPONSE,{},0)}else if(K===12&&it>=19){super();this.initialize(w.RESPONSE,{},e[we],0)}else if(K>12&&K<16){super();this.initialize(w.RESPONSE,{},e[we],Yt,0)}else if(K>=16){super();this.initialize(w.RESPONSE,{},e[we],0)}else super(w.RESPONSE);this.client=e,this.socket=r,this.timeout=null,this.statusCode=null,this.upgrade=!1,this.headers=null,this.shouldKeepAlive=!1,this.request=null,this.paused=!1,this.resuming=!1,this.queue=[],this._resume=()=>{if(!(!this.paused||this.resuming)){for(this.paused=!1,this.resuming=!0;this.queue.length;){let[n,...s]=this.queue.shift();if(Reflect.apply(n,this,s),this.paused){this.resuming=!1;return}}this.resuming=!1,tr(this.socket)}},this._pause=()=>{this.paused||(this.paused=!0,er(this.socket))}}[w.kOnHeaders](e){if(this.paused){this.queue.push([this[w.kOnHeaders],e]);return}this.headers?Array.prototype.push.apply(this.headers,e):this.headers=e}[w.kOnExecute](e){if(this.paused){this.queue.push([this[w.kOnExecute],e]);return}let{upgrade:r,socket:n}=this;if(!Number.isFinite(e)){f(e instanceof Error),h.destroy(n,e);return}if(r&&!n.destroyed){let{client:s,headers:o,statusCode:u,request:c}=this;f(!n.destroyed),f(n===s[m]),f(!n.isPaused()),f(n._handle&&n._handle.reading),f(c.upgrade),this.headers=null,this.statusCode=null,this.request=null,n._readableState.flowing=null,n.unshift(this.getCurrentBuffer().slice(e));try{c.onUpgrade(u,o,n),!n.destroyed&&!c.aborted&&(ct(n),s[m]=null,s[y][s[b]++]=null,s.emit("disconnect",new M("upgrade"))),x(s)}catch(l){h.destroy(n,l)}}}[w.kOnHeadersComplete](e,r,n,s,o,u,c,l,a){if(this.paused){this.queue.push([this[w.kOnHeadersComplete],e,r,n,s,o,u,c,l,a]);return}let{client:i,socket:d}=this,p=i[y][i[b]];if(d.destroyed)return;if(clearTimeout(this.timeout),this.timeout=i[Le]?setTimeout(Zt,i[Le],this):null,f(!this.upgrade),f(this.statusCode<200),u===100)return h.destroy(d,new de("bad response")),1;if(p.upgrade!==!0&&l!==Boolean(p.upgrade))return h.destroy(d,new de("bad upgrade")),1;if(this.headers?Array.prototype.push.apply(this.headers,n):this.headers=n,this.statusCode=u,this.shouldKeepAlive=a,this.request=p,p.upgrade)return this.unconsume(),this.upgrade=!0,2;let k,O,{headers:_}=this;this.headers=null;for(let C=0;C<_.length;C+=2){let T=_[C+0],v=_[C+1];!k&&T.length===10&&T.toLowerCase()==="keep-alive"?k=v:!O&&T.length===7&&T.toLowerCase()==="trailer"&&(O=v)}if(this.trailers=O?O.toLowerCase().split(/,\s*/):null,a&&i[I]){let C=k?h.parseKeepAliveTimeout(k):null;if(C!=null){let T=Math.min(C-i[nt],i[rt]);T<=0?d[L]=!0:i[be]=T}else i[be]=i[Oe]}else d[L]=!0;try{p.onHeaders(u,_,this._resume)===!1&&this._pause()}catch(C){return h.destroy(d,C),1}return p.method==="HEAD"||u<200?1:0}[w.kOnBody](e,r,n){if(this.paused){this.queue.push([this[w.kOnBody],e,r,n]);return}let{socket:s,statusCode:o,request:u,timeout:c}=this;if(!s.destroyed){c&&c.refresh&&c.refresh(),f(o>=200);try{u.onData(e.slice(r,r+n))===!1&&this._pause()}catch(l){h.destroy(s,l)}}}[w.kOnMessageComplete](){if(this.paused){this.queue.push([this[w.kOnMessageComplete]]);return}let{client:e,socket:r,statusCode:n,headers:s,upgrade:o,request:u,trailers:c}=this;if(!r.destroyed){if(f(n>=100),f(this.resuming||r._handle&&r._handle.reading),o){f(n<300||u.method==="CONNECT");return}if(this.statusCode=null,this.headers=null,this.request=null,this.trailers=null,clearTimeout(this.timeout),this.timeout=e[J]?setTimeout(lt,e[J],this):null,!(n<200)){try{if(c){if(!s)throw new Ze;for(let l of c){let a=!1;for(let i=0;i<s.length;i+=2){let d=s[i+0];if(d.length===l.length&&d.toLowerCase()===l.toLowerCase()){a=!0;break}}if(!a)throw new Ze}}try{u.onComplete(s)}catch(l){u.onError(l)}}catch(l){h.destroy(r,l);return}e[y][e[b]++]=null,r[U]?h.destroy(r,new M("reset")):this.shouldKeepAlive?r[L]&&!e.running?h.destroy(r,new M("reset")):x(e):h.destroy(r,new M("reset"))}}}destroy(){clearTimeout(this.timeout),this.timeout=null,this.unconsume(),setImmediate(e=>e.close(),this)}};function Zt(t){t.paused||h.destroy(t.socket,new Jt)}function lt(t){h.destroy(t.socket,new Qt)}function rr(){let{[j]:t}=this;t.emit("connect"),x(t)}function dt(t){let{[j]:e}=this;if(this[ye]=t,t.code==="ERR_TLS_CERT_ALTNAME_INVALID")for(f(!e.running);e.pending&&e[y][e[R]].host===e[fe];)e[y][e[R]++].onError(t);else if(!e.running&&t.code!=="UND_ERR_INFO"&&t.code!=="UND_ERR_SOCKET"){f(e[R]===e[b]);for(let r of e[y].splice(e[b]))r.onError(t)}}function ft(){h.destroy(this,new de("other side closed"))}function ct(t){clearTimeout(t[W]),t[W]=null,t[Te]=null,t[pe].destroy(),t[pe]=null,t[j]=null,t[ye]=null,t.removeListener("session",mt).removeListener("error",dt).removeListener("end",ft).removeListener("close",pt)}function pt(){let{[j]:t}=this,e=this[ye]||new de("closed");if(ct(this),t[m]=null,e.code!=="UND_ERR_INFO"&&(t[Q]=null),t[A]){f(!t.pending);for(let r of t[y].splice(t[b]))r.onError(e);t[R]=t[b]}else t.running&&e.code!=="UND_ERR_INFO"&&(t[y][t[b]].onError(e),t[y][t[b]++]=null),t[R]=t[b],t.emit("disconnect",e);x(t)}function mt(t){let{[j]:e}=this;e[Q]=t}function at(t){f(!t[m]);let{protocol:e,port:r,hostname:n}=t[N],s;if(e==="https:"){let u=De(He({},t[ge]),{servername:t[me],session:t[Q]});s=t[G]?Ye.connect(t[G],u):Ye.connect(r||443,n,u),s.on("session",mt)}else s=t[G]?Xe.connect(t[G]):Xe.connect(r||80,n);t[m]=s;let o=new ht(t,s);K>=12?(f(s._handle),o.consume(s._handle)):(f(s._handle&&s._handle._externalStream),o.consume(s._handle._externalStream)),s[W]=null,s[Te]=null,s[U]=!1,s[L]=!1,s[ye]=null,s[pe]=o,s[j]=t,s.setNoDelay(!0).on(e==="https:"?"secureConnect":"connect",rr).on("error",dt).on("end",ft).on("close",pt)}function er(t){if(t._handle&&t._handle.reading){t._handle.reading=!1;let e=t._handle.readStop();e&&t.destroy(h.errnoException(e,"read"))}}function tr(t){if(t._handle&&!t._handle.reading){t._handle.reading=!0;let e=t._handle.readStart();e&&t.destroy(h.errnoException(e,"read"))}}function gt(t){t[V]=0,t.emit("drain")}function x(t,e){t[D]!==2&&(t[D]=2,nr(t,e),t[D]=0,t[b]>256&&(t[y].splice(0,t[b]),t[R]-=t[b],t[b]=0))}function nr(t,e){for(;;){if(t[A]){f(!t.pending);return}if(t[z]&&!t.size){t.destroy(h.nop);continue}if(t[m]){let s=t[m],o=t.running?0:t[be];s[Te]!==o&&(clearTimeout(s[W]),o&&(s[W]=setTimeout(u=>{h.destroy(u,new M("socket idle timeout"))},o,s)),s[Te]=o)}if(t.running){let{aborted:s}=t[y][t[b]];if(s){h.destroy(t[m]);return}}if(t.busy)t[V]=2;else if(t[V]===2){e?(t[V]=1,process.nextTick(gt,t)):gt(t);continue}if(!t.pending||t.running>=(t[I]||1))return;let r=t[m],n=t[y][t[R]];if(t[N].protocol==="https:"&&t[fe]!==n.host){if(t.running)return;t[fe]=n.host;let s=ot(t,n.host);if(t[me]!==s&&(t[me]=s,t[Q]=null,r)){h.destroy(r,new M("servername changed"));return}}if(!r){at(t);return}if(!t.connected||r[U]||r[L]||t.running&&!n.idempotent||t.running&&n.upgrade||(h.isStream(n.body)&&h.bodyLength(n.body)===0&&(n.body.on("data",function(){f(!1)}).on("error",function(s){n.onError(s)}).on("end",function(){h.destroy(this)}),n.body=null),t.running&&h.isStream(n.body)))return;if(!n.aborted&&sr(t,n)){let s=t[m][pe];!s.timeout&&t[J]&&(s.timeout=setTimeout(lt,t[J],s)),t[R]++}else t[y].splice(t[R],1)}}function sr(t,e){let{body:r,method:n,path:s,host:o,upgrade:u,headers:c}=e,l=n==="PUT"||n==="POST"||n==="PATCH";r&&typeof r.read=="function"&&r.read(0);let a=h.bodyLength(r);if(a===null&&(a=e.contentLength),a===0&&!l&&(a=null),e.contentLength!==null&&e.contentLength!==a)return e.onError(new Ce),!1;if(e.aborted)return!1;try{e.onConnect(p=>{e.aborted||(e.onError(p||new et),t[D]===0&&x(t,!0))})}catch(p){e.onError(p)}if(e.aborted)return!1;let i=t[m];n==="HEAD"&&(i[L]=!0),u&&(i[L]=!0);let d;if(typeof u=="string"?d=`${n} ${s} HTTP/1.1\r
connection: upgrade\r
upgrade: ${u}\r
`:t[I]?d=`${n} ${s} HTTP/1.1\r
connection: keep-alive\r
`:d=`${n} ${s} HTTP/1.1\r
connection: close\r
`,o||(d+=t[tt]),c&&(d+=c),!r)a===0?i.write(`${d}content-length: ${a}\r
\r
\r
`,"ascii"):(f(a===null,"no body must not have content length"),i.write(`${d}\r
`,"ascii"));else if(h.isBuffer(r))f(a!==null,"buffer body must have content length"),i.cork(),i.write(`${d}content-length: ${a}\r
\r
`,"ascii"),i.write(r),i.write(`\r
`,"ascii"),i.uncork(),l||(i[L]=!0);else{i[U]=!0,f(h.isStream(r)),f(a!==0||!t.running,"stream body cannot be pipelined");let p=!1,k=0,O=function(v){try{f(!p);let B=Buffer.byteLength(v);if(!B)return;if(a!==null&&k+B>a){h.destroy(i,new Ce);return}k===0&&(l||(i[L]=!0),a===null?i.write(`${d}transfer-encoding: chunked\r
`,"ascii"):i.write(`${d}content-length: ${a}\r
\r
`,"ascii")),a===null&&i.write(`\r
${B.toString(16)}\r
`,"ascii"),k+=B,!i.write(v)&&this.pause&&this.pause()}catch(B){h.destroy(this,B)}},_=function(){f(!p),r.resume&&r.resume()},C=function(){T(new et)},T=function(v){p||(p=!0,f(i.destroyed||i[U]&&t.running<=1),i[U]=!1,!v&&a!==null&&k!==a&&(v=new Ce),i.removeListener("drain",_).removeListener("error",T),r.removeListener("data",O).removeListener("end",T).removeListener("error",T).removeListener("close",C),h.destroy(r,v),v&&(f(t.running<=1,"pipeline should only contain this request"),h.destroy(i,v)),!i.destroyed&&(k===0?l?i.write(`${d}content-length: 0\r
\r
\r
`,"ascii"):i.write(`${d}\r
`,"ascii"):a===null&&i.write(`\r
0\r
\r
`,"ascii"),x(t)))};r.on("data",O).on("end",T).on("error",T).on("close",C),i.on("drain",_).on("error",T)}return!0}Je.exports=ut});var bt=Y(yt());var xe=class{constructor(){this.headers={};this.statusCode=null}_addBody(e){let r=this.headers["content-length"];this.body=Buffer.concat(e,r?Number(r):void 0)}_parseHeaders(e){for(let r=1;r<e.length;r+=2){let n=e[r-1].toLowerCase(),s=this.headers[n];s?(Array.isArray(s)||(s=[s],this.headers[n]=s),s.push(e[r])):this.headers[n]=e[r]}}json(e="utf8"){return JSON.parse(this.body.toString(e))}text(e="utf8"){return this.body.toString(e)}};var wt=Y(require("url")),Tt=Y(require("path")),Et=Y(require("querystring")),_e=class{constructor(e,r="GET"){this.coreOptions={};this.httpMethod="GET";this.reqHeaders={};this.timeoutOptions={};if(this.url=typeof e=="string"?new wt.URL(e):e,this.httpMethod=r,!["http:","https:"].includes(this.url.protocol))throw new Error(`Bad URL protocol: ${this.url.protocol}`)}client(e,r){return this.kClient=e,r&&(this.keepClient=!0),this}query(e,r){if(typeof e=="object"){let n=Object.keys(e);for(let s=0;s<n.length;++s){let o=n[s];this.url.searchParams.append(o,e[o])}}else this.url.searchParams.append(e,r);return this}path(e){return this.url.pathname=(0,Tt.join)(this.url.pathname,e),this}signal(e){return this.controller=e,this}body(e,r){switch(r){case"json":{this.data=JSON.stringify(e),this.header({"content-type":"application/json","content-length":Buffer.byteLength(this.data).toString()});break}case"form":{this.data=(0,Et.stringify)(e),this.header({"content-type":"application/x-www-form-urlencoded","content-length":Buffer.byteLength(this.data).toString()});break}case"stream":{this.data=e;break}default:{typeof e=="object"&&!Buffer.isBuffer(e)?(this.data=JSON.stringify(e),this.header({"content-type":"application/json","content-length":Buffer.byteLength(this.data).toString()})):(this.data=e,this.header("content-length",Buffer.byteLength(this.data).toString()));break}}return this}header(e,r){if(typeof e=="object"){let n=Object.keys(e);for(let s=0;s<n.length;++s){let o=n[s];this.reqHeaders[o.toLowerCase()]=e[o]}}else this.reqHeaders[e.toLowerCase()]=r;return this}method(e){return this.httpMethod=e,this}timeout(e,r){return typeof e=="string"?this.timeoutOptions[e]=r:this.timeoutOptions.bodyTimeout=e,this}option(e,r){return typeof e=="object"?Object.assign(this.coreOptions,e):this.coreOptions[e]=r,this}async json(){return(await this.send()).json()}async raw(){return(await this.send()).body}async text(){return(await this.send()).text()}send(){return new Promise((e,r)=>{var c;let n={path:this.url.pathname+this.url.search,method:this.httpMethod,headers:this.reqHeaders,body:this.data,signal:this.controller},s=(c=this.kClient)!=null?c:new bt.default(this.url.origin,this.coreOptions),o=new xe,u=[];s.dispatch(n,{onData:l=>u.push(l),onError:l=>r(l),onComplete:()=>{this.keepClient||s.close(),o._addBody(u),e(o)},onConnect:()=>null,onHeaders:(l,a,i)=>{o.statusCode=l,o._parseHeaders(a),i()}})})}};module.exports=function(e,r="GET"){return new _e(e,r)};
